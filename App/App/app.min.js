(function(){"use strict";angular.module("http-auth-interceptor",["http-auth-interceptor-buffer"]).factory("authService",["$rootScope","httpBuffer",function(n,t){return{loginConfirmed:function(i,r){var u=r||function(n){return n};n.$broadcast("event:auth-loginConfirmed",i);t.retryAll(u)},loginCanceled:function(i){n.$broadcast("event:auth-loginCanceled",i);t.rejectAll()}}}]).config(["$httpProvider",function(n){var t=["$rootScope","$q","httpBuffer",function(n,t,i){var r={};return r.response=function(r){if(r.status===401&&!r.config.ignoreAuthModule){var u=t.defer();return i.append(r,u),n.$broadcast("event:auth-loginRequired"),u.promise}return r},r}];n.interceptors.push(t)}]);angular.module("http-auth-interceptor-buffer",[]).factory("httpBuffer",["$injector",function(n){function r(t,r){function u(n){r.resolve(n)}function f(n){r.reject(n)}i=i||n.get("$http");i(t).then(u,f)}var t=[],i;return{append:function(n,i){t.push({response:n,deferred:i})},retryAll:function(n){for(var i=0;i<t.length;++i)r(n(t[i].response.config),t[i].deferred);t=[]},rejectAll:function(){for(var n=0;n<t.length;++n)t[n].deferred.reject(t[n].response);t=[]}}}])})(),function(n,t){"use strict";n.module("interceptors",[]).config(["$httpProvider",function(n){n.interceptors.push("httpRequestInterceptorIECacheSlayer");n.interceptors.push("errorHttpInterceptor");n.interceptors.push("httpAjaxInterceptor")}]).factory("httpRequestInterceptorIECacheSlayer",["$log",function(n){return{request:function(t){if(t.url.indexOf("App/")==-1){var i=new Date;t.url=t.url+"?cacheSlayer="+i.getTime()}return n.info("request.url = "+t.url),t}}}]).factory("errorHttpInterceptor",["$q",function(n){return{response:function(i){return i.status==401?i:i.status==400&&i.data&&i.data.message?(t.error(i.data.message),n.reject(i)):i.status===0?(t.error("Server connection lost"),n.reject(i)):i.status>=400&&i.status<500?(t.error("Server was unable to find what you were looking for... Sorry!!"),n.reject(i)):i}}}]).factory("httpAjaxInterceptor",["$q","$location","$rootScope","$timeout",function(n,t,i,r){function s(){u.push({});u.length==1&&(o=r(function(){u.length&&i.$broadcast("event:ajax-show")},500))}function e(){u.pop();u.length==0&&(f=r(function(){u.length==0&&(i.$broadcast("event:ajax-hide"),f&&r.cancel(f))},500))}var u=[],o=null,f=null;return{request:function(t){return s(),t||n.when(t)},response:function(t){return e(),t||n.when(t)},responseError:function(t){return e(),t||n.when(t)}}}])}(angular,toastr),function(n,t){"use strict";var i=n.module("services",[]);i.factory("$auth",["$q","$http","$path",function(n,t,i){function f(n,i){var r="Bearer "+n;return delete t.defaults.headers.common.Authorization,t.defaults.headers.common.Authorization=r,sessionStorage.accessToken=n,i&&(localStorage.accessToken=n),r}function s(){sessionStorage.removeItem("accessToken");localStorage.removeItem("accessToken");delete t.defaults.headers.common.Authorization}var e=i("api/Account/Profile"),o=i("api/Account/Token"),r={},u;return r.getUserName=function(){return u},r.isAuthenticated=function(){return u&&u.length},r.loadSaved=function(){var i=n.defer(),r=sessionStorage.accessToken||localStorage.accessToken;return r?(f(r),t.get(e,{ignoreAuthModule:!0}).success(function(n){u=n.userName;i.resolve({userName:n.userName})}).error(function(){s();i.reject()})):i.reject(),i.promise},r.login=function(i,r,u){var e=n.defer();return t.post(o,{userName:i,password:r}).success(function(n){var t=f(n.accessToken,u);e.resolve({userName:n.userName,Authorization:t})}).error(function(){e.reject()}),e.promise},r}]);i.factory("$safeApply",function(){return function(n,t){var i=n.$root.$$phase;i=="$apply"||i=="$digest"?t&&n.$eval(t):t?n.$apply(t):n.$apply()}});i.factory("$path",function(){var t=window.location.href,i=t.indexOf("#"),n=t;return i>0&&(n=t.substr(0,i)),n[n.length-1]!="/"&&(n=n+"/"),function(t){return n+t}});i.factory("$signalR",["$rootScope",function(n){var i=n.$new(),r=t.connection.signalrAppenderHub;return r.client.onLoggedEvent=function(n){i.$emit("loggedEvent",n)},t.connection.hub.start(),i}])}(window.angular,window.jQuery),function(n){"use strict";var t=n.module("resources",[]);t.factory("TodoItem",["$resource","$path",function(n,t){return n(t("api/TodoItem/:id"),{id:"@Id"},{update:{method:"PUT"}})}]);t.factory("TodoList",["$resource","$path",function(n,t){return n(t("api/TodoList/:id/:action"),{id:"@Id"},{todos:{method:"GET",isArray:!0,params:{action:"Todos"}}})}])}(window.angular),function(n,t){"use strict";var i=n.module("directives",[]);i.directive("busyIndicator",["$rootScope",function(n){return{restrict:"A",link:function(t,i){var r=null;n.$on("event:ajax-show",function(){r||(r=i[0].innerHTML,i[0].innerHTML="Loading...")});n.$on("event:ajax-hide",function(){i[0].innerHTML=r||i[0].innerHTML;r=null})}}}]);i.directive("authDialog",function(){var n=0;return{restrict:"A",link:function(t,i){function u(){n==0&&r.modal("show");n++}function f(){n>0&&r.modal("hide")}function e(){n--;n>0&&(n=0,u())}var r=$(i);r.modal({backdrop:!1,keyboard:!1,show:!1});$(i).on("hidden.bs.modal",e);t.$on("event:auth-loginRequired",u);t.$on("event:auth-loginConfirmed",f);t.$on("event:auth-loginCanceled",f)}}});i.directive("onFocus",function(){return{restrict:"A",link:function(n,t,i){t.bind("focus",function(){n.$apply(i.onFocus)})}}}).directive("onBlur",function(){return{restrict:"A",link:function(n,t,i){t.bind("blur",function(){n.$apply(i.onBlur)})}}}).directive("onEnter",function(){return function(n,t,i){t.bind("keydown keypress",function(t){t.which===13&&(n.$apply(function(){n.$eval(i.onEnter)}),t.preventDefault())})}}).directive("selectedWhen",function(){return function(n,t,i){n.$watch(i.selectedWhen,function(n){n&&t.select()})}});t.input.placeholder||i.directive("placeholder",function(){return{restrict:"A",require:"ngModel",link:function(n,t,i,r){var u,f=function(){t.val(i.placeholder)},e=function(){t.val("")};n.$watch(i.ngModel,function(n){u=n||""});t.bind("focus",function(){u==""&&e()});t.bind("blur",function(){t.val()==""&&f()});r.$formatters.unshift(function(n){return n?n:(f(),u="",i.placeholder)})}}})}(window.angular,Modernizr),function(n){"use strict";var t=n.module("controllers",[]);t.controller("HomeCtrl",["$scope",function(n){n.title="Home"}]);t.controller("TodosCtrl",["$scope","$safeApply","TodoList","TodoItem",function(n,t,i,r){n.newTodoListName="";n.todoLists=i.query();n.expand=function(n){n.todoItems||(n.todoItems=i.todos({id:n.id}))};n.addTodoList=function(){var r=new i;r.title=n.newTodoListName;r.$save(function(i){t(n,function(){n.todoLists.push(i);n.newTodoListName=""})})};n.removeTodoList=function(t){var r=t.id;i.remove(t,function(){for(var t=0;t<n.todoLists.length;t++)if(n.todoLists[t].id==r){n.todoLists.splice(t,1);break}})};n.addTodoItem=function(i){var u=new r;u.title=i.newTodoItemName;u.todoListId=i.id;u.$save(function(r){t(n,function(){i.todoItems.push(r);i.newTodoItemName=""})})};n.saveTodoItem=function(n){r.update(n)};n.removeTodoItem=function(n,t){var i=t.id;r.remove(t,function(){for(var t=0;t<n.todoItems.length;t++)if(n.todoItems[t].id==i){n.todoItems.splice(t,1);break}})}}]);t.controller("AboutCtrl",["$scope",function(n){n.title="About"}]);t.controller("SettingsCtrl",["$scope",function(n){n.title="Settings"}]);t.controller("NavCtrl",["$scope","$location",function(n,t){n.getClass=function(n){var i=t.path();return i.indexOf(n)===0?"active":""}}]);t.controller("LoginCtrl",["$scope","$safeApply","authService","$rootScope","$auth",function(n,t,i,r,u){n.userName="";n.password="";n.rememberMe=!1;n.signIn=function(){u.login(n.userName,n.password,n.rememberMe).then(function(u){t(n,function(){r.userName=u.userName});i.loginConfirmed({user:u.userName},function(n){return n.headers.Authorization=u.Authorization,n})})};n.cancel=function(){i.loginCanceled()}}]);t.controller("LogsCtrl",["$scope","$safeApply","$signalR",function(n,t,i){n.logs=[];var r=[];r.FATAL="alert alert-error repeat-item";r.ERROR="alert alert-error repeat-item";r.WARN="alert alert-info repeat-item";r.INFO="alert alert-success repeat-item";r.DEBUG="alert alert-info repeat-item";i.$on("loggedEvent",function(i,u){t(n,function(){u.class=r[u.Level];n.logs.splice(0,0,u)})});n.clearLogs=function(){n.logs.length=0}}])}(window.angular),function(n,t,i){"use strict";i.options.closeButton=!0;i.options.newestOnTop=!1;i.options.positionClass="toast-bottom-right";n.app=t.module("app",["ngRoute","ngAnimate","ngResource","services","directives","resources","controllers","http-auth-interceptor","interceptors"]);var r=function(n){i.error(n.message||n)};app.value("$exceptionHandler",r);app.config(["$routeProvider","$locationProvider",function(n,t){n.when("/home",{templateUrl:"App/views/home.html",controller:"HomeCtrl"}).when("/todos",{templateUrl:"App/views/todos.html",controller:"TodosCtrl",resolve:{authentication:["$http",function(n){return n.get("api/Account/Ping")}]}}).when("/about",{templateUrl:"App/views/about.html",controller:"AboutCtrl"}).when("/settings",{templateUrl:"App/views/settings.html",controller:"SettingsCtrl",resolve:{authentication:["$http",function(n){return n.get("api/Account/Ping")}]}}).when("/logs",{templateUrl:"App/views/logs.html",controller:"LogsCtrl"}).otherwise({redirectTo:"/home"});t.html5Mode(!1).hashPrefix("!")}]);app.run(["$rootScope","$location","$window","$auth",function(n,t,i,r){n.today=new Date;r.loadSaved().then(function(t){n.userName=t.userName});n.$on("$routeChangeError",function(n,r,u){u?t.path(u.originalPath):i.location.reload()})}])}(window,angular,toastr);
/*
//# sourceMappingURL=app.min.js.map
*/